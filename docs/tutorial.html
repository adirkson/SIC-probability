
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutorial &#8212; Prob_SIC_forecasts 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation" href="code.html" />
    <link rel="prev" title="Calibrated Probabilistic Forecasts of Sea Ice Concentration" href="index.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="code.html" title="Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Calibrated Probabilistic Forecasts of Sea Ice Concentration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Prob_SIC_forecasts 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="zero-and-one-inflated-beta-distribution">
<h2>Zero- and One- Inflated Beta Distribution<a class="headerlink" href="#zero-and-one-inflated-beta-distribution" title="Permalink to this headline">¶</a></h2>
<p>Here, we’ll go through some of the ways the <a class="reference internal" href="code.html#module-beinf" title="beinf"><code class="xref py py-class docutils literal"><span class="pre">beinf</span></code></a> class can be utilized. The <a class="reference internal" href="code.html#module-beinf" title="beinf"><code class="xref py py-class docutils literal"><span class="pre">beinf</span></code></a> class is an instance of a subclass of <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous" title="(in SciPy v1.0.0)"><code class="xref py py-class docutils literal"><span class="pre">rv_continuous</span></code></a>, and therefore inherits all of the methods from <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous" title="(in SciPy v1.0.0)"><code class="xref py py-class docutils literal"><span class="pre">rv_continuous</span></code></a>. In addition, some methods have been added that aren’t included in <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous" title="(in SciPy v1.0.0)"><code class="xref py py-class docutils literal"><span class="pre">rv_continuous</span></code></a> that are useful for applying the BEINF distribution to the sea ice concentration (SIC) variable (see the documentation for the <a class="reference internal" href="code.html#module-beinf" title="beinf"><code class="xref py py-class docutils literal"><span class="pre">beinf</span></code></a> class).</p>
<p>First, define some arbitrary BEINF distribution parameters and freeze the distribution object</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">beinf</span> <span class="kn">import</span> <span class="n">beinf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">beinf</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<p>This <code class="code docutils literal"><span class="pre">rv</span></code> object can now be used to call on any of the methods in <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.html#scipy.stats.rv_continuous" title="(in SciPy v1.0.0)"><code class="xref py py-class docutils literal"><span class="pre">rv_continuous</span></code></a>. For example, we can compute its first few moments</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurt</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can compute the sea ice probability (SIP) quantity (i.e. the probability that SIC&gt;0.15) using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.cdf.html#scipy.stats.rv_continuous.cdf" title="(in SciPy v1.0.0)"><code class="xref py py-meth docutils literal"><span class="pre">cdf()</span></code></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">x_l</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">sip</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x_l</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, we can plot its pdf and cdf over the interval [0,1] using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.pdf.html#scipy.stats.rv_continuous.pdf" title="(in SciPy v1.0.0)"><code class="xref py py-meth docutils literal"><span class="pre">pdf()</span></code></a> and <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.cdf.html#scipy.stats.rv_continuous.cdf" title="(in SciPy v1.0.0)"><code class="xref py py-meth docutils literal"><span class="pre">cdf()</span></code></a> methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact pdf&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="c1"># plot probability masses at 0 and 1 as circles</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.01</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability Density&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Probability </span><span class="se">\n</span><span class="s1"> Density Function&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact cdf&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.01</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$P(X\leq x)$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cumulative </span><span class="se">\n</span><span class="s1"> Distribution Function&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                    <span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/beinf_example1.png" src="_images/beinf_example1.png" />
</div>
<p>Now, we’ll generate some random variates from this distribution using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.rvs.html#scipy.stats.rv_continuous.rvs" title="(in SciPy v1.0.0)"><code class="xref py py-meth docutils literal"><span class="pre">rvs()</span></code></a>) method, and plot its histogram and empirical cumulative distribution function (utilizing the added <a class="reference internal" href="code.html#beinf.beinf_gen.ecdf" title="beinf.beinf_gen.ecdf"><code class="xref py py-meth docutils literal"><span class="pre">ecdf()</span></code></a> method) along with the original distribution:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">nsamples</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span> <span class="c1"># draw random sample</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sample hist&#39;</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;stepfilled&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span> <span class="c1">#update legend</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beinf</span><span class="o">.</span><span class="n">ecdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">X</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sample ecdf&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/beinf_example2.png" src="_images/beinf_example2.png" />
</div>
<p>Note that we have used the <a class="reference internal" href="code.html#beinf.beinf_gen.ecdf" title="beinf.beinf_gen.ecdf"><code class="xref py py-meth docutils literal"><span class="pre">ecdf()</span></code></a> method to compute the distribution function for the sample. We’ll now fit this random sample to the BEINF distribution (using <a class="reference internal" href="code.html#beinf.beinf_gen.fit" title="beinf.beinf_gen.fit"><code class="xref py py-meth docutils literal"><span class="pre">fit()</span></code></a>) and freeze a distribution object as <code class="code docutils literal"><span class="pre">rv_f</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">p_f</span><span class="p">,</span> <span class="n">q_f</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">rv_f</span> <span class="o">=</span> <span class="n">beinf</span><span class="p">(</span><span class="n">a_f</span><span class="p">,</span> <span class="n">b_f</span><span class="p">,</span> <span class="n">p_f</span><span class="p">,</span> <span class="n">q_f</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we’ll plot its pdf and cdf along with the original distribution and random sample.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rv_f</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fitted pdf&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p_f</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q_f</span><span class="p">),</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">p_f</span><span class="o">*</span><span class="n">q_f</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rv_f</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fitted cdf&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>   <span class="c1">#update legend</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/beinf_example3.png" src="_images/beinf_example3.png" />
</div>
</div>
<div class="section" id="trend-adjusted-quantile-mapping">
<h2>Trend-adjusted Quantile Mapping<a class="headerlink" href="#trend-adjusted-quantile-mapping" title="Permalink to this headline">¶</a></h2>
<p>This section of the tutorial shows how to apply trend-adjusted quantile mapping (TAQM) using the <a class="reference internal" href="code.html#module-taqm" title="taqm"><code class="xref py py-class docutils literal"><span class="pre">taqm</span></code></a> class. The methods in this class are meant to be applied to the SIC variable at an individual grid cell.</p>
<p>In Example 1, we’ll show how TAQM works for a grid cell for which the trend-adjusted modelled historical (TAMH) ensemble time series, the trend-adjusted observed historical (TAOH) time series, and the forecast ensemble can all be fit to the BEINF distribution (i.e. cases 1-4 are not encountered for any of these data samples). In Example 2, we’ll show what happens when one of cases 2-4 is encountered. In Example 3, we’ll go through a situation when case 1 is encountered (i.e. one of <span class="math">\(p_x=1\)</span>, <span class="math">\(p_y=1\)</span>, or <span class="math">\(p_{x_t}=1\)</span>).</p>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>Define the time variables relevant to calibration. The complete hindcast record is from 1981-2012 and the forecast year is 2011. The range of years <span class="math">\(\tau_t\)</span> thus covers 1981-2012 excluding 2011.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">taqm</span> <span class="kn">import</span> <span class="n">taqm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="kn">from</span> <span class="nn">beinf</span> <span class="kn">import</span> <span class="n">beinf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Time</span>
<span class="n">tau_s</span> <span class="o">=</span> <span class="mi">1981</span>    <span class="c1">#start year</span>
<span class="n">tau_f</span> <span class="o">=</span> <span class="mi">2012</span>    <span class="c1">#finish year</span>
<span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tau_s</span><span class="p">,</span><span class="n">tau_f</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1">#array of years in hindcast record</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">2011</span>   <span class="c1">#forecast year</span>
<span class="n">tau_t</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">tau</span><span class="o">!=</span><span class="n">t</span><span class="p">]</span>   <span class="c1"># remove the forecast year from tau and call it tau_t</span>
</pre></div>
</div>
<p>Load the model historical (MH) ensemble time series, observed historical (OH) time series, and the forecast ensemble. MH and OH do not contain the data for year <span class="math">\(t\)</span>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;MH.npy&#39;</span><span class="p">)</span>   <span class="c1">#load MH data</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;OH.npy&#39;</span><span class="p">)</span>   <span class="c1">#load OH data</span>
<span class="n">X_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;Raw_fcst.npy&#39;</span><span class="p">)</span>   <span class="c1">#load raw forecast</span>
<span class="n">Y_t</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1">#made-up observation</span>
</pre></div>
</div>
<p>Instantiate a <a class="reference internal" href="code.html#module-taqm" title="taqm"><code class="xref py py-class docutils literal"><span class="pre">taqm</span></code></a> object, and perform the trend-adjustment on the MH and OH data using the <a class="reference internal" href="code.html#taqm.taqm.trend_adjust_2p" title="taqm.taqm.trend_adjust_2p"><code class="xref py py-func docutils literal"><span class="pre">trend_adjust_2p()</span></code></a> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">taqm</span> <span class="o">=</span> <span class="n">taqm</span><span class="p">()</span>

<span class="c1"># Get TAMH from MH</span>
<span class="n">pval_x</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">tau_t</span><span class="p">,</span><span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1">#check the p-value for MH trend over tau_t</span>
<span class="k">if</span> <span class="n">pval_x</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">:</span>
    <span class="c1"># if significant, then adjust MH for the trend to create TAMH</span>
    <span class="n">X_ta</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">trend_adjust_2p</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">tau_t</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t_b</span><span class="o">=</span><span class="mi">1999</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># else, set TAMH equal to MH (i.e. don&#39;t perform the trend adjustment)</span>
    <span class="n">X_ta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Get TAOH from OH</span>
<span class="n">pval_y</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">tau_t</span><span class="p">,</span><span class="n">Y</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>     <span class="c1">#check p-value for OH trend over tau_t</span>
<span class="k">if</span> <span class="n">pval_y</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">:</span>
    <span class="c1"># if significant, then adjust OH for the trend to create TAOH</span>
    <span class="n">Y_ta</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">trend_adjust_2p</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">tau_t</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">t_b</span><span class="o">=</span><span class="mi">1999</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># else, set TAOH equal to OH (i.e. don&#39;t perform the trend adjustment)</span>
    <span class="n">Y_ta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>The following is a plot of the <code class="code docutils literal"><span class="pre">X</span></code> and <code class="code docutils literal"><span class="pre">Y</span></code> (top panel) , and <code class="code docutils literal"><span class="pre">X_ta</span></code> and <code class="code docutils literal"><span class="pre">Y_ta</span></code> (bottom panel), with the ensemble range for <code class="code docutils literal"><span class="pre">X</span></code> and <code class="code docutils literal"><span class="pre">X_ta</span></code> encapsulated in the shaded area.</p>
<div class="figure">
<img alt="_images/taqm_example1_trendadjust.png" src="_images/taqm_example1_trendadjust.png" />
</div>
<p>Fit the TAMH, TAOH, and forecast ensemble to the BEINF distribution using the <a class="reference internal" href="code.html#taqm.taqm.fit_params" title="taqm.taqm.fit_params"><code class="xref py py-func docutils literal"><span class="pre">fit_params()</span></code></a> method in the <a class="reference internal" href="code.html#module-taqm" title="taqm"><code class="xref py py-class docutils literal"><span class="pre">taqm</span></code></a> class.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X_ta_params</span><span class="p">,</span> <span class="n">Y_ta_params</span><span class="p">,</span> <span class="n">X_t_params</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">fit_params</span><span class="p">(</span><span class="n">X_ta</span><span class="p">,</span><span class="n">Y_ta</span><span class="p">,</span><span class="n">X_t</span><span class="p">)</span>
</pre></div>
</div>
<p>Before calibrating, it’s convenient to define the variable <code class="code docutils literal"><span class="pre">trust_sharp_fcst</span></code>, which is used to indicate what should be done when the forecast BEINF distribution has <span class="math">\(p_{x_t}=1\)</span> (i.e. all ensemble members have 0% or 100% SIC). Two choices are to: (1) not calibrate (i.e. trust the raw forecast) or (2) revert to the TAOH distribution (i.e. trust the trend-adjusted climatology). For (1), set <code class="code docutils literal"><span class="pre">trust_sharp_fcst=True</span></code>; for (2) set <code class="code docutils literal"><span class="pre">trust_sharp_fcst=False</span></code>. For this example it doesn’t matter, because <span class="math">\(p_{x_t}\neq 1\)</span>, but we’ll keep this variable here as part of the general template, and set it arbitrarily to <cite>False</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Calibrate forecast</span>
<span class="n">trust_sharp_fcst</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>Now calibrate the forecast ensemble using the <a class="reference internal" href="code.html#taqm.taqm.calibrate" title="taqm.taqm.calibrate"><code class="xref py py-func docutils literal"><span class="pre">calibrate()</span></code></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X_t_cal_params</span><span class="p">,</span> <span class="n">X_t_cal</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">X_ta_params</span><span class="p">,</span> <span class="n">Y_ta_params</span><span class="p">,</span> <span class="n">X_t_params</span><span class="p">,</span>
                                                <span class="n">X_ta</span><span class="p">,</span> <span class="n">Y_ta</span><span class="p">,</span> <span class="n">X_t</span><span class="p">,</span><span class="n">trust_sharp_fcst</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal_params</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="mf">0.4193</span>  <span class="mf">2.6118</span>  <span class="mf">0.1968</span>  <span class="mf">0.</span>    <span class="p">]</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span><span class="p">]</span>
</pre></div>
</div>
<p>As described in the documentation for <a class="reference internal" href="code.html#taqm.taqm.calibrate" title="taqm.taqm.calibrate"><code class="xref py py-func docutils literal"><span class="pre">calibrate()</span></code></a>, the array <code class="code docutils literal"><span class="pre">X_t_cal_params</span></code> contains the four BEINF parameters fit to the calibrated forecast ensemble, and the <code class="code docutils literal"><span class="pre">X_t_cal</span></code> array contains the calibrated ensemble, where in this example each value set to <code class="code docutils literal"><span class="pre">np.inf</span></code> because the four BEINF distribution parameters are defined.</p>
<p>Next, we’re going to plot these distributions and calculate the continuous rank probability score (CRPS) for this single forecast.</p>
<p>First, get the individual BEINF parameters from the arrays containing the parameters using <a class="reference internal" href="code.html#taqm.taqm.unpack_params" title="taqm.taqm.unpack_params"><code class="xref py py-func docutils literal"><span class="pre">unpack_params()</span></code></a>. It’s useful to work with these variables instead of the arrays containing the parameters, as it keep things more readable.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">a_x_ta</span><span class="p">,</span> <span class="n">b_x_ta</span><span class="p">,</span> <span class="n">p_x_ta</span><span class="p">,</span> <span class="n">q_x_ta</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">unpack_params</span><span class="p">(</span><span class="n">X_ta_params</span><span class="p">)</span>
<span class="n">a_y_ta</span><span class="p">,</span> <span class="n">b_y_ta</span><span class="p">,</span> <span class="n">p_y_ta</span><span class="p">,</span> <span class="n">q_y_ta</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">unpack_params</span><span class="p">(</span><span class="n">Y_ta_params</span><span class="p">)</span>
<span class="n">a_x_t</span><span class="p">,</span> <span class="n">b_x_t</span><span class="p">,</span> <span class="n">p_x_t</span><span class="p">,</span> <span class="n">q_x_t</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">unpack_params</span><span class="p">(</span><span class="n">X_t_params</span><span class="p">)</span>
<span class="n">a_x_t_cal</span><span class="p">,</span> <span class="n">b_x_t_cal</span><span class="p">,</span> <span class="n">p_x_t_cal</span><span class="p">,</span> <span class="n">q_x_t_cal</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">unpack_params</span><span class="p">(</span><span class="n">X_t_cal_params</span><span class="p">)</span>
</pre></div>
</div>
<p>Second, freeze the four distribution objects</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">rv_x_ta</span> <span class="o">=</span> <span class="n">beinf</span><span class="p">(</span><span class="n">a_x_ta</span><span class="p">,</span> <span class="n">b_x_ta</span><span class="p">,</span> <span class="n">p_x_ta</span><span class="p">,</span> <span class="n">q_x_ta</span><span class="p">)</span> <span class="c1">#TAMH</span>
<span class="n">rv_y_ta</span> <span class="o">=</span> <span class="n">beinf</span><span class="p">(</span><span class="n">a_y_ta</span><span class="p">,</span> <span class="n">b_y_ta</span><span class="p">,</span> <span class="n">p_y_ta</span><span class="p">,</span> <span class="n">q_y_ta</span><span class="p">)</span> <span class="c1">#TAOH</span>
<span class="n">rv_x_t</span> <span class="o">=</span> <span class="n">beinf</span><span class="p">(</span><span class="n">a_x_t</span><span class="p">,</span> <span class="n">b_x_t</span><span class="p">,</span> <span class="n">p_x_t</span><span class="p">,</span> <span class="n">q_x_t</span><span class="p">)</span> <span class="c1">#Raw forecast ensemble</span>
<span class="n">rv_x_t_cal</span> <span class="o">=</span> <span class="n">beinf</span><span class="p">(</span><span class="n">a_x_t_cal</span><span class="p">,</span> <span class="n">b_x_t_cal</span><span class="p">,</span> <span class="n">p_x_t_cal</span><span class="p">,</span> <span class="n">q_x_t_cal</span><span class="p">)</span> <span class="c1">#Calibrated forecast ensemble</span>
</pre></div>
</div>
<p>Finally, evaluate the cdf for each of these using the <a class="reference internal" href="code.html#beinf.beinf_gen.cdf_eval" title="beinf.beinf_gen.cdf_eval"><code class="xref py py-meth docutils literal"><span class="pre">cdf_eval()</span></code></a> method in the <a class="reference internal" href="code.html#module-beinf" title="beinf"><code class="xref py py-class docutils literal"><span class="pre">beinf</span></code></a> class. This method handles instances when <span class="math">\(a\)</span> and <span class="math">\(b\)</span> aren’t known (and given the value <code class="code docutils literal"><span class="pre">np.inf</span></code>), in which case the cdf over (0,1) is computed using the <a class="reference internal" href="code.html#beinf.beinf_gen.ecdf" title="beinf.beinf_gen.ecdf"><code class="xref py py-meth docutils literal"><span class="pre">ecdf()</span></code></a> method. When <span class="math">\(a\)</span> and <span class="math">\(b\)</span> are known (as is the case in this example), <a class="reference internal" href="code.html#beinf.beinf_gen.cdf_eval" title="beinf.beinf_gen.cdf_eval"><code class="xref py py-meth docutils literal"><span class="pre">cdf_eval()</span></code></a> evaluates the cdf using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.cdf.html#scipy.stats.rv_continuous.cdf" title="(in SciPy v1.0.0)"><code class="xref py py-meth docutils literal"><span class="pre">cdf()</span></code></a> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Evaluate cdf for the TAMH distribution at x</span>
<span class="n">cdf_x_ta</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">cdf_eval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">X_ta_params</span><span class="p">,</span><span class="n">X_ta</span><span class="p">)</span>

<span class="c1"># Evaluate cdf for the TAOH distribution at x</span>
<span class="n">cdf_y_ta</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">cdf_eval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Y_ta_params</span><span class="p">,</span><span class="n">Y_ta</span><span class="p">)</span>

<span class="c1"># Evaluate cdf for the forecast distribution at x</span>
<span class="n">cdf_x_t</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">cdf_eval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">X_t_params</span><span class="p">,</span><span class="n">X_t</span><span class="p">)</span>
</pre></div>
</div>
<p>To evaluate the cdf for the calibrated forecast ensemble, it’s slightly more complicated. This is because we must deal with instances when either the raw forecast was “trusted” or the TAOH was “trusted” (as described above). These complications can be accounted for though simply using this <code class="code docutils literal"><span class="pre">if-else</span></code> statement.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Evaluate cdf for the calibrated forecast distribution at x</span>
<span class="k">if</span> <span class="n">trust_sharp_fcst</span><span class="o">==</span><span class="bp">True</span> <span class="ow">and</span> <span class="n">p_x_t</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">cdf_x_t_cal</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">cdf_eval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">X_t_params</span><span class="p">,</span><span class="n">X_t</span><span class="p">)</span> <span class="c1"># go with the original forecast data/distribution</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">p_x_t</span><span class="o">==</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="n">cdf_x_t_cal</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">cdf_eval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Y_ta_params</span><span class="p">,</span><span class="n">Y_ta</span><span class="p">)</span>   <span class="c1"># go with the TAOH data/distribution</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cdf_x_t_cal</span> <span class="o">=</span> <span class="n">beinf</span><span class="o">.</span><span class="n">cdf_eval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">X_t_cal_params</span><span class="p">,</span><span class="n">X_t_cal</span><span class="p">)</span>   <span class="c1"># go with the calibrated forecast data/distribution</span>
</pre></div>
</div>
<p>Here are the cdfs for each of these distributions</p>
<div class="figure">
<img alt="_images/taqm_example1_cdfs.png" src="_images/taqm_example1_cdfs.png" />
</div>
<p>This is how we can calculate the CRPS for this forecast based on the observed value <code class="code docutils literal"><span class="pre">Y_t=0.2</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Heaviside function for obs</span>
<span class="n">cdf_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">cdf_obs</span><span class="p">[</span><span class="n">Y_t</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># CRPS for the raw forecast</span>
<span class="n">crps_x_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.135445548061</span>

<span class="c1"># CRPS for the calibrated forecast</span>
<span class="n">crps_x_t_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t_cal</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t_cal</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.0880923964244</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>For a situation when one of cases 2-4 are encountered (for any of the TAMH, TAOH, or raw forecast), we’ll actually use the exact same code used in Example 1. Of course different data are loaded. In this case, the forecast distribution satisfies case 2 (all but one ensemble member are 0’s and 1’s)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Change directory to where the data is stored and load data</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;MH_case2.npy&#39;</span><span class="p">)</span> <span class="c1">#load MH data</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;OH_case2.npy&#39;</span><span class="p">)</span> <span class="c1">#load OH data</span>
<span class="n">X_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;Raw_fcst_case2.npy&#39;</span><span class="p">)</span> <span class="c1">#load raw forecast</span>
<span class="n">Y_t</span> <span class="o">=</span> <span class="mf">0.5</span>   <span class="c1">#made-up observation</span>
</pre></div>
</div>
<p>By executing the same code as above, when we calibrate the forecast ensemble using the <a class="reference internal" href="code.html#taqm.taqm.calibrate" title="taqm.taqm.calibrate"><code class="xref py py-func docutils literal"><span class="pre">calibrate()</span></code></a> method, we get:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X_t_cal_params</span><span class="p">,</span> <span class="n">X_t_cal</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">X_ta_params</span><span class="p">,</span> <span class="n">Y_ta_params</span><span class="p">,</span> <span class="n">X_t_params</span><span class="p">,</span>
                                                <span class="n">X_ta</span><span class="p">,</span> <span class="n">Y_ta</span><span class="p">,</span> <span class="n">X_t</span><span class="p">,</span><span class="n">trust_sharp_fcst</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal_params</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span>   <span class="n">inf</span>    <span class="n">inf</span>  <span class="mf">0.129</span>  <span class="mf">0.</span>   <span class="p">]</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="mf">0.0629</span>     <span class="n">inf</span>     <span class="n">inf</span>     <span class="n">inf</span>     <span class="n">inf</span>     <span class="n">inf</span>     <span class="n">inf</span>     <span class="n">inf</span>     <span class="n">inf</span>
      <span class="n">inf</span><span class="p">]</span>
</pre></div>
</div>
<p>Using the <a class="reference internal" href="code.html#beinf.beinf_gen.cdf_eval" title="beinf.beinf_gen.cdf_eval"><code class="xref py py-meth docutils literal"><span class="pre">cdf_eval()</span></code></a> (as in Example 1), the TAMH, TAOH, raw forecast, and calibrated forecast cdfs can be plotted:</p>
<div class="figure">
<img alt="_images/taqm_example2.png" src="_images/taqm_example2.png" />
</div>
<p>As can be seen, only the single non-0/non-1 ensemble member in <code class="code docutils literal"><span class="pre">X_t</span></code> is quantile mapped. Additionaly, the probability <span class="math">\(P(X_t=0)\)</span> has been shifted from 0.9 to 0.13 according to the bias in this probability in the TAMH ensemble time series.</p>
<p>The CRPS values for the raw and calibrated forecast are computed as in Example 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Heaviside function for obs</span>
<span class="n">cdf_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">cdf_obs</span><span class="p">[</span><span class="n">Y_t</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># CRPS for the raw forecast</span>
<span class="n">crps_x_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.456351351351</span>

<span class="c1"># CRPS for the calibrated forecast</span>
<span class="n">crps_x_t_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t_cal</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t_cal</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.394183986276</span>
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<p>For a situation when case 1 is encountered for one of TAMH, TAOH, or the raw forecast, we’ll still execute the same code used in Example 1.</p>
<p>First we’ll load the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Change directory to where the data is stored and load data</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;MH_case3.npy&#39;</span><span class="p">)</span> <span class="c1">#load MH data</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;OH_case3.npy&#39;</span><span class="p">)</span> <span class="c1">#load OH data</span>
<span class="n">X_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;Raw_fcst_case3.npy&#39;</span><span class="p">)</span> <span class="c1">#load raw forecast</span>
<span class="n">Y_t</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1">#made-up observation</span>
</pre></div>
</div>
<p>For these particular data, both the MH and raw forecast data have <span class="math">\(p=1\)</span>. Because <span class="math">\(p_{x_t}=1\)</span> for this example, we have the choice of trusting the raw forecast or reverting to the TAOH distribution. To show how these choices differ, we’ll first set</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">trust_raw_fcst</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>The calibrated forecast parameters and values are</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X_t_cal_params</span><span class="p">,</span> <span class="n">X_t_cal</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">X_ta_params</span><span class="p">,</span> <span class="n">Y_ta_params</span><span class="p">,</span> <span class="n">X_t_params</span><span class="p">,</span>
                                                <span class="n">X_ta</span><span class="p">,</span> <span class="n">Y_ta</span><span class="p">,</span> <span class="n">X_t</span><span class="p">,</span><span class="n">trust_sharp_fcst</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal_params</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="n">inf</span>  <span class="n">inf</span>   <span class="mf">1.</span>   <span class="mf">0.</span><span class="p">]</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span><span class="p">]</span>
</pre></div>
</div>
<p>The cdfs for the TAMH, TAOH, raw forecast, and calibrated forecast computed using <a class="reference internal" href="code.html#beinf.beinf_gen.cdf_eval" title="beinf.beinf_gen.cdf_eval"><code class="xref py py-meth docutils literal"><span class="pre">cdf_eval()</span></code></a> can be seen in the following plot:</p>
<div class="figure">
<img alt="_images/taqm_example3_TrustRaw.png" src="_images/taqm_example3_TrustRaw.png" />
</div>
<p>Because we have set <code class="code docutils literal"><span class="pre">trust_raw_fcst</span> <span class="pre">=</span> <span class="pre">True</span></code>, the cdfs in the right-hand panel are identical. The CRPS values for the raw and calibrated forecast are computed as in Examples 1 and 2, and are also equivalent:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Heaviside function for obs</span>
<span class="n">cdf_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">cdf_obs</span><span class="p">[</span><span class="n">Y_t</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># CRPS for the raw forecast</span>
<span class="n">crps_x_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.14964964965</span>

<span class="c1"># CRPS for the calibrated forecast</span>
<span class="n">crps_x_t_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t_cal</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t_cal</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.14964964965</span>
</pre></div>
</div>
<p>Alternatively, we could revert to the TAOH distribution by setting</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">trust_raw_fcst</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>If we do this, we get the following calibrated forecast parameters and values:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X_t_cal_params</span><span class="p">,</span> <span class="n">X_t_cal</span> <span class="o">=</span> <span class="n">taqm</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">X_ta_params</span><span class="p">,</span> <span class="n">Y_ta_params</span><span class="p">,</span> <span class="n">X_t_params</span><span class="p">,</span>
                                                <span class="n">X_ta</span><span class="p">,</span> <span class="n">Y_ta</span><span class="p">,</span> <span class="n">X_t</span><span class="p">,</span><span class="n">trust_sharp_fcst</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal_params</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span>  <span class="mf">1.0603</span>  <span class="mf">26.2562</span>   <span class="mf">0.7742</span>   <span class="mf">0.</span>    <span class="p">]</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">X_t_cal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span>  <span class="n">inf</span><span class="p">]</span>
</pre></div>
</div>
<p>The plots of the cdfs for the four distributions are:</p>
<div class="figure">
<img alt="_images/taqm_example3_TrustTAOH.png" src="_images/taqm_example3_TrustTAOH.png" />
</div>
<p>and CRPS values:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Heaviside function for obs</span>
<span class="n">cdf_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">cdf_obs</span><span class="p">[</span><span class="n">Y_t</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># CRPS for the raw forecast</span>
<span class="n">crps_x_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.14964964965</span>

<span class="c1"># CRPS for the calibrated forecast</span>
<span class="n">crps_x_t_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">((</span><span class="n">cdf_x_t_cal</span> <span class="o">-</span> <span class="n">cdf_obs</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">crps_x_t_cal</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mf">0.133379212736</span>
</pre></div>
</div>
<p>In this particular case, we would thus have achieved a more skillful forecast by reverting to the TAOH distribution and not the raw forecast.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Calibrated Probabilistic Forecasts of Sea Ice Concentration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="code.html"
                        title="next chapter">Documentation</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="code.html" title="Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Calibrated Probabilistic Forecasts of Sea Ice Concentration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Prob_SIC_forecasts 1.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Arlan Dirkson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>